
## Компиляция и сборка

Компилятор `nasm` с форматом `-f elf64` преобразует файл `file.asm` в объектный файл `.o`:

```sh
nasm -f elf64 file.asm
```


Далее объектный файл собирается в исполняемый файл с помощью `gcc` с ключом `-no-pie`:

```sh
gcc -no-pie file.o -o file.exe
```

## Работа с отрицательными числами в бинарном виде

Числа хранятся в дополнительном коде.

Примеры:

### -1 в дополнительном коде

```
  0000 0001
  1111 1110 +
  1111 1111  (это -1)
```

### -1 + 1

```
  1111 1111 +
  0000 0001
  0000 0000  (из-за отброшенного переноса — результат 0)
```

### -8 в дополнительном коде

```
  0000 1000
  1111 0111 +
  0000 0001
  1111 1000  (это -8)
```

### 127 + 1 (переполнение знакового разряда)

```
  0111 1111 +
  0000 0001
  1000 0000  (это -128 в знаковом представлении)
```

- Беззнаковые числа: 0 … 255
- Знаковые числа: -128 … 127

## Флаги процессора

Флаги используются для анализа состояния после выполнения инструкций:

|Флаг|Значение|
|---|---|
|**CF** (Carry Flag)|Флаг переноса (используется в беззнаковых операциях)|
|**OF** (Overflow Flag)|Флаг переполнения (важен для знаковых операций)|
|**ZF** (Zero Flag)|Флаг нуля (результат = 0)|
|**SF** (Sign Flag)|Флаг знака (1, если результат отрицательный)|

Пример установки OF при переполнении:

```
  255 + 1
  1111 1111
  0000 0001
  1000 0000  (OF = 1, так как старший бит изменил знак)
```


## Операции сравнения

Операция сравнения `x - y` устанавливает флаги, которые затем используются в условных переходах.


Пример:



- SF ≠ OF → `a < b`
- SF = OF → `a ≥ b`

## Операции умножения и деления

### Инструкции умножения

- `mul` — умножение без знака
- `imul` — умножение со знаком

Результат умножения сохраняется в **AX**, **DX:AX**, **EDX:EAX**, **RDX:RAX** в зависимости от размера операнда.

Пример умножения:

### Инструкции деления

- `div` — деление без знака
- `idiv` — деление со знаком

Деление в разных режимах:



Пример деления:



## Инструкции `imul` и `idiv`


Этот конспект содержит основные сведения о работе с NASM, включая флаги, операции сравнения, арифметику и условные переходы.