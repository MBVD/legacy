
# Введение

### Платформы:

1) FreeBSD 8.0 (работает на 32 разрядном процессоре Intel Pentium)
2) Linux 3.2.0 (дистрибутив Ubuntu 12.04) (свободная ОС UNIX-подобная) (работает на 64 разрядном Intel Core i5)
3) Apple Mac OS X 10.6.8 (Intel Core 2 Duo)
4) Solaris 10 (Oracle) (работает на UltraSPARC IIi)

Это книга предназначена для всех, кто пишет программы, работающие под управлением UNIX

Unix предоставляет работающим в ней программам разнообразные услуги:

**Интерфейс системных вызовов (System Call Interface)**
1) Открытие и чтение файлов
2) Запуск новых программ
3) выделение памяти
4) получение текущего времени
5) ...
Огромное Количество функций языка C

### Стандарты UNIX

Международные стандарты
Стандарт ANSI языка С, семейство стандартов IEEE POSIX, руководство по обеспечению переносимости X/Open

### Перечень систем, использовавшихся для тестирования примеров

![[Pasted image 20240906101110.png]]

4.xBSD подразумевает различные ОС Computer Systems Research Group. BSD Net 1 и BSD Net 2 - ОС семейства 4.xBSD

SVRx - System V Release x от AT&T. XPG3

ANSI C - стандарт языка С

POSIX.1 - стандарт ISO и IEEE интерфейса UNIX


# Обзор OC UNIX

## Архитектура UNIX

ОС определяется как программное обеспечение, управляющее аппаратными ресурсами компьютера и предоставляющее среду для выполнения прикладных программ. 

>[!Note]
>Это программное обеспечение называют ядром (kernel)

>[!Note]
>Системные вызовы - это интерфейс ядра, являющийся слоем программного обеспечения.

библиотеки функций общего использования основываются на интерфейсе системных вызовов.

>[!Note]
>Командная оболочка (shell) — это особое приложение, которое предоставляет интерфейс для запуска других приложений.


![[Pasted image 20240906102044.png]]


Linux - это ядро ОС UNIX 

## Вход в систему

### Имя пользователя

При входе в систему UNIX мы вводим имя пользователя и пароль.

Файл паролей: /etc/passwd

Файл паролей содержит записи, состоящие из семи полей, разделенные двоеточием

имя пользователя, зашифрованный пароль, числовой идентификатор пользователя (205), числовой идентификатор группы (105), поле комментария, домашний каталог (/home/sar) и командный интерпретатор (/bin/ksh)

Пример:  sar:x:205:105:Stephen Rago:/home/sar:/bin/ksh

### Командные оболочки

>[!Note]
>Командная оболочка — это интерпретатор командной строки, который читает ввод пользователя и выполняет команды.

>[!Note]
>Сценарий КО - Ввод пользователя считываемый из файла

>[!Note]
Интерактивная КО - Ввод пользователя считываемый с терминалами


![[Pasted image 20240906102736.png]]

Система запускает тот интерпретатор, который определен из записи в файле паролей
### Файлы и каталоги

#### Файловая система

Файловая система UNIX имеет древовидную иерархическую структуру, состоящую из каталогов и файлов. Начинается она с _корневого_ каталога, имеющего имя из единственного символа /.

>[!Note] 
>Каталог - это файл, содержащий каталожные записи. 

Запись можно представить в виде структуры: имя файла и атрибуты файла(тип файла, размер, владелец, разрешения, время последнего изменения.) Функции **stat** и **fstat** возвращают структуру с информацией обо всех атрибутах файла

#### Имя файла

>[!Note] Определение
>Имена элементов каталога называются именами файлов (filenames)

>[!warning]
>(/) и (\0) не могут встречаться в именах файлов

Всякий раз, когда создаётся новый каталог, в нем автоматически создаются две записи: (.) и (..)

Записи (.) соответствует текущий каталог
Записи (..) соответствует родительский каталог

#### Путь к файлу

>[!Note] Определение
>Последовательность из одного или более имен файлов, разделенных слешем, образует строку _пути к файлу_

/baobab/lala.exe - абсолютный путь
baobab/lala.exe - относительный путь


> [!info] Пример
> Реализации команды ls(1)
```c
#include "apue.h"
#include <dirent.h>
int main(int argc, char *argv[])
{
	DIR *dp; 
	struct dirent *dirp; 
	if (argc != 2) 
		err_quit("Использование: ls имя_каталога"); 
	if ((dp = opendir(argv[1])) == NULL) 
		err_sys("невозможно открыть %s", argv[1]); 
	while ((dirp = readdir(dp)) != NULL) 
		printf("%s\n", dirp->d_name); 
		
	closedir(dp); 
	exit(0); 
}

```
 

#### Рабочий каталог

>[!Note] Определение
>Рабочий Каталог - это каталог, от которого откладываются все относительные пути, используемые в программе. У каждого процесса имеется свой рабочий каталог

>[!Tip] Замечание
>chdir - изменяет рабочий каталог процессу

#### Домашний каталог

>[!Note] Определение
>Домашний каталог пользователя определяется в соответствии с записью в файле паролей


### Ввод и вывод

#### Дескрипторы файлов

>[!Note] Определение
>Дескрипторы файлов - это небольшие целые положительные числа, используемые ядром для идентификации файлов, к которым обращается конкретный процесс

Всякий раз, когда процесс открывает существующий или новый файл, ядро возвращает его дескриптор. Дескриптор в свою очередь используется для выполнений операций чтения/записи с файлом.

#### Стандартный ввод, стандартный вывод, стандартный вывод ошибок

Большинство командных оболочек дает возможность перенаправить любой из этих дескрипторов в любой файл

```
ls > file.list
```

Выполняется команда ls и перенаправляет стандартный вывод в файл с именем file.list

## Программы и процессы

### Программа

>[!Note] Определение
> Программа - это выполняемый файл, хранящийся на диске.

>[!Note] Определение
>Выполняющая программа называется процессом

UNIX присваивает каждому процессу уникальный числовой идентификатор, который называется идентификатором процесса (process ID, или PID). Идентификатор процесса — всегда целое неотрицательное число

```c
#include "apue.h"
int main(void) {
	printf("Привет от процесса с идентификатором %d\n", (long)getpid());
	exit(0);
}
```

```c
$ ./a.out 
привет от процесса с идентификатором 851 
$ ./a.out 
привет от процесса с идентификатором 854
```

### Управление процессом 

три основные функции: fork, exec и waitpid

```c
int open(const *char name,)
```